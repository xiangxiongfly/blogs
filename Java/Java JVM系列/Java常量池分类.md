[TOC]

# Java常量池分类

在Java中常量池可分为：class常量池、运行时常量池、字符串常量池。



## class常量池

Java程序需要先通过javac编译器生成字节码(.class)文件，在由虚拟机(JVM)解释执行。

class文件里存放着类的版本、字段、方法、接口等信息，还包含常量池，用于存放编译期生成的各种字面量和符号引用。class中的常量池也称为静态常量池。

常量池的内容都会被加载到运行时常量池中。



## 运行时常量池

运行时常量池就是将字节码文件中的信息放入方法区中，属于方法区的一部分。

在类的加载阶段，class常量池的信息会被加载转存到运行时常量池中；类在解析阶段后，会将符号引用转为直接引用，与字符串常量池中的引用保持一致。

每个类都有一个运行时常量池，可以用来动态获取类信息。



## 字符串常量池

字符串常量池里的内容是在类加载、验证、准备后放入的。

字符串常量池在每个虚拟机中只有一份，在虚拟机的堆区中，存放的是字符串常量的引用。

字符串常量池是一个StringTable类，HashTable结构，key是根据字符串和长度计算的hash值，value是字符串的引用，字符串实例放在堆中。



**注意：**

在JDK 8中，字符串常量池和静态变量在堆内存，从物理分区来说，字符串常量池属于堆；但从逻辑分区来说，字符串常量池属于方法区。

JVM在加载一个类时，必须经过加载、连接、初始化，其中连接包含验证、准备、解析三个阶段。当类加载到内存中后，JVM会将字节码文件中的常量池存放在运行时常量池中，因此运行时常量池是每个类都有的，在解析阶段，会把符号引用转为直接引用，解析度过程会查询字符串常量池，保证了运行时常量池锁引用的字符串和字符串常量池是一致的。

