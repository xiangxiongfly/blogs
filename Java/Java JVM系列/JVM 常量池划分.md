[TOC]

# JVM 常量池划分

## 概述

在Java中常量池可分为：静态常量池、运行时常量池、字符串常量池。

- 静态常量池（Class Constant Pool）：这是每个类或接口的常量池，存储在该类或接口的 .class 文件中。它包含了该类或接口的字面量和符号引用。属于方法区。  
- 运行时常量池（Runtime Constant Pool）：这是每个类或接口在Java虚拟机（JVM）运行时的常量池。它是静态常量池的运行时表示，包含了更多的信息，如类和接口的直接引用。属于方法区。 
- 字符串常量池（String Constant Pool）：这是Java虚拟机（JVM）为字符串对象专门设立的一种常量池。它可以实现字符串的共享。 在 Java 7 之前，字符串常量池是方法区的一部分；在 Java 7 及以后版本，字符串常量池被移到堆内存中，以便更好的进行垃圾回收。字符串常量池是一种特殊的内存区域，用于缓存字符串常量，当你创建一个字符串常量时，它会先检查字符串常量池中是否已经存在相同的字符串，如果存在，则返回常量池中的引用，如果不存在，则将字符串添加到常量池中并返回引用。字符串常量池只保存字符串的引用，而字符串的实际内容则保存在堆内存中。



## 静态常量池

静态常量池（Class Constant Pool）也称为Class常量池或编译时常量池。

Java 编译器将 .java 文件编译生成 .class 文件， .class 文件里面都包含了一个常量池，因为这个常量池是在 .class文件里面定义的，编译后不能被修改，因此也称为静态常量池。

静态常量池主要存储各种字面量和符号引用。

**静态常量池主要内容：**

1. 字面量：
   - 数值常量：整数（int、short、byte、long），浮点数（float、double），字符（char），布尔值（boolean）。
   - 字符串常量：字符串字面量。
2. 符号引用：
   - 类和接口名：全限定名（包名和类名）。
   - 字段引用：字段的类或接口名称、字段名和描述符。
   - 方法引用：方法的类或接口名称、方法名和描述符。
3. 其他常量：null，枚举常量。

可以通过 `javap -v xxx.class` 命令查看常量池信息：

![在这里插入图片描述](https://img-blog.csdnimg.cn/1920986e42444ef6bcfa217f7edc1fa5.png)



## 运行时常量池

运行时常量池是类和接口的 .class 文件在虚拟机中的表示，是它是静态常量池的运行时表示形式。运行时常量池也是存储在方法区的。运行时常量池是在类加载时动态生成的，它包含了类常量池中的常量值、字段和方法的符号引用等信息，以及一些在编译期无法确定的部分，例如动态链接信息等。运行时常量池的内容可以在运行时进行修改，例如通过反射等机制。

**运行时常量池主要内容：**

1. 字面量：数值字面量、字符串字面量。
2. 符号引用：
   - 类和接口的引用：类和接口的全限定名。
   - 字段的引用：类和接口的全限定名、字段名、字段描述符。
   - 方法的引用：类和接口的全限定名、方法名、方法描述符。
3. 方法句柄和方法类型。
4. 动态计算的常量：Java 11引入的常量动态（ConstantDynamic），支持动态语言和复杂的框架。 
5. 名称和类型：描述字段和方法的名称和描述符。
6. UIT-8编码的字符串：用于类、方法、接口、字段的名称等。



## 字符串常量池

字符串常量池里的内容是在类加载、验证、准备后放入的。

在 Java 7 之前，字符串常量池是方法区的一部分；在 Java 7 及以后版本，字符串常量池被移到堆内存中，以便更好的进行垃圾回收。

字符串常量池在每个虚拟机中只有一份，存放在虚拟机的堆区中，字符串常量池存储的是字符串常量的引用，而不是字符串对象本身。它的存在可以提高内存效率和性能。字符串实际内容存放在堆内存中。 

